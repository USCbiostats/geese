<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GEne Evolutionary model using SufficiEnsy • geese</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="GEne Evolutionary model using SufficiEnsy">
<meta property="og:description" content="Discrete Exponential Markov Models are a
  family of statistical models that can be used to describe dynamic transitions
  of phenomena with multivariate bernoulli distributed features. What the package
  does (one paragraph). These models include GEESE (GEne Evolutionary model
  using SufficiEnsy) (Vega Yon et al. 2021).">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">geese</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<p><a href="https://image.usc.edu" class="external-link"><img src="https://raw.githubusercontent.com/USCbiostats/badges/master/tommy-image-badge.svg" alt="Integrative Methods of Analysis for Genetic Epidemiology"></a></p>
<div class="section level1">
<div class="page-header"><h1 id="geese-gene-functional-evolution-using-sufficiency-">geese: <em>GE</em>ne-functional <em>E</em>volution using <em>S</em>uffici<em>E</em>ncy <img src="reference/figures/logo.svg" align="right" width="180px"><a class="anchor" aria-label="anchor" href="#geese-gene-functional-evolution-using-sufficiency-"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>This R package taps into statistical theory mostly developed in the social networks realm. Using Exponential-Family Random Graph Models (ERGMs), <code>geese</code> provides an statistical framework for building Gene Functional Evolution Models using Sufficiency. For example, users can directly hypothesize whether Neofunctionalization or Subfunctionalization events were taking place in a phylogeny, without having to estimate the full transition Markov Matrix that is usually used.</p>
<p>GEESE is computationally efficient, with C++ under-the-hood, allowing the analyses of either single trees (a GEESE) or multiple trees simulatenously (pooled model), in a Flock.</p>
<p>This is work in progress and based on the theoretical work developed duing <a href="https://ggv.cl" class="external-link">George G. Vega Yon</a>’s doctoral thesis.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<!-- You can install the released version of geese from [CRAN](https://CRAN.R-project.org) with: -->
<!-- ``` r -->
<!-- install.packages("geese") -->
<!-- ``` -->
<p>The development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"USCbiostats/geese"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h1>
<div class="section level2">
<h2 id="simulating-annotations-two-different-sets">Simulating annotations (two different sets)<a class="anchor" aria-label="anchor" href="#simulating-annotations-two-different-sets"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geese</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preparing data</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100L</span></span>
<span><span class="va">annotations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">9</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random tree</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">31</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">aphylo</span><span class="fu">::</span><span class="fu">sim_tree</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">$</span><span class="va">edge</span> <span class="op">-</span> <span class="fl">1L</span></span>
<span></span>
<span><span class="va">duplication</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="va">n</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reading the data in</span></span>
<span><span class="va">amodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese-class.html">new_geese</a></span><span class="op">(</span></span>
<span>  annotations <span class="op">=</span> <span class="va">annotations</span>,</span>
<span>  geneid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>  parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  duplication <span class="op">=</span> <span class="va">duplication</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Preparing the model</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_gains</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_loss</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_maxfuns</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-common.html">init_model</a></span><span class="op">(</span><span class="va">amodel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing nodes in Geese (this could take a while)...</span></span>
<span><span class="co">#&gt; ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</span></span>
<span></span>
<span><span class="co"># Testing</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># Gains</span></span>
<span>  <span class="fl">2</span>, <span class="fl">1.5</span>,</span>
<span>  <span class="co"># Loss</span></span>
<span>  <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1.5</span>,</span>
<span>  <span class="co"># Max funs</span></span>
<span>  <span class="fl">2</span>, </span>
<span>  <span class="co"># Root probabilities</span></span>
<span>  <span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gain0"</span>, <span class="st">"gain1"</span>, <span class="st">"loss0"</span>, <span class="st">"loss1"</span>, <span class="st">"onefun"</span>, <span class="st">"root0"</span>, <span class="st">"root1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/geese-common.html">likelihood</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="va">params</span><span class="op">*</span><span class="fl">0</span><span class="op">)</span> <span class="co"># Equals 1 b/c all missings</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># Simulating data</span></span>
<span><span class="va">fake1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese-common.html">sim_geese</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">amodel</span>, par <span class="op">=</span> <span class="va">params</span>, seed <span class="op">=</span> <span class="fl">1110</span><span class="op">)</span></span>
<span><span class="va">fake2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese-common.html">sim_geese</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">amodel</span>, par <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>We can now visualize either of the annotations using the <a href="https://github.com/USCbiostats/aphylo" class="external-link">aphylo</a> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USCbiostats/aphylo" class="external-link">aphylo</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ape</span></span>
<span><span class="va">ap</span> <span class="op">&lt;-</span> <span class="fu">aphylo_from_data_frame</span><span class="op">(</span></span>
<span>  tree        <span class="op">=</span> <span class="fu">as.phylo</span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>, </span>
<span>  annotations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">fake1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ap</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-viz-with-aphylo-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="model-fitting-mle">Model fitting MLE<a class="anchor" aria-label="anchor" href="#model-fitting-mle"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating the object</span></span>
<span><span class="va">amodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese-class.html">new_geese</a></span><span class="op">(</span></span>
<span>  annotations <span class="op">=</span> <span class="va">fake1</span>,</span>
<span>  geneid      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>  parent      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  duplication <span class="op">=</span> <span class="va">duplication</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Adding the model terms</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_gains</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_loss</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_maxfuns</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We need to initialize to do all the accounting</span></span>
<span><span class="fu"><a href="reference/geese-common.html">init_model</a></span><span class="op">(</span><span class="va">amodel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing nodes in Geese (this could take a while)...</span></span>
<span><span class="co">#&gt; ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">amodel</span><span class="op">)</span></span>
<span><span class="co">#&gt; GEESE</span></span>
<span><span class="co">#&gt; INFO ABOUT PHYLOGENY</span></span>
<span><span class="co">#&gt; # of functions           : 2</span></span>
<span><span class="co">#&gt; # of nodes [int; leaf]   : [199; 100]</span></span>
<span><span class="co">#&gt; # of ann. [zeros; ones]  : [87; 113]</span></span>
<span><span class="co">#&gt; # of events [dupl; spec] : [99; 0]</span></span>
<span><span class="co">#&gt; Largest polytomy         : 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; INFO ABOUT THE SUPPORT</span></span>
<span><span class="co">#&gt; Num. of Arrays     : 396</span></span>
<span><span class="co">#&gt; Support size       : 4</span></span>
<span><span class="co">#&gt; Support size range : [0, 14]</span></span>
<span><span class="co">#&gt; Model terms (5)   :</span></span>
<span><span class="co">#&gt;  - Gains 0 at duplication</span></span>
<span><span class="co">#&gt;  - Gains 1 at duplication</span></span>
<span><span class="co">#&gt;  - Loss 0 at duplication</span></span>
<span><span class="co">#&gt;  - Loss 1 at duplication</span></span>
<span><span class="co">#&gt;  - Genes with [1, 1] funs at duplication</span></span>
<span></span>
<span><span class="co"># Finding MLE</span></span>
<span><span class="fu"><a href="reference/geese_mle.html">geese_mle</a></span><span class="op">(</span><span class="va">amodel</span>, hessian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1]  1.3024291  1.4904183 -1.4668169 -0.9165704  1.8952822 -0.1918496 -0.5043625</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] -58.54824</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      454       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $hessian</span></span>
<span><span class="co">#&gt;               [,1]          [,2]          [,3]          [,4]          [,5]</span></span>
<span><span class="co">#&gt; [1,] -1.920339e+00  3.092661e-02  9.719647e-02 -5.826438e-01  1.230857e+00</span></span>
<span><span class="co">#&gt; [2,]  3.092661e-02 -2.155737e+00 -2.661554e-01  2.058254e+00  2.388066e+00</span></span>
<span><span class="co">#&gt; [3,]  9.719647e-02 -2.661554e-01 -1.562040e+00  1.126001e-01 -1.189657e+00</span></span>
<span><span class="co">#&gt; [4,] -5.826438e-01  2.058254e+00  1.126001e-01 -5.959471e+00 -3.427126e+00</span></span>
<span><span class="co">#&gt; [5,]  1.230857e+00  2.388066e+00 -1.189657e+00 -3.427126e+00 -2.441145e+01</span></span>
<span><span class="co">#&gt; [6,] -8.064660e-07  1.930012e-06 -1.188383e-06  3.367084e-06 -4.565237e-07</span></span>
<span><span class="co">#&gt; [7,]  6.355805e-06 -8.340431e-04  9.558576e-06 -6.562342e-04  1.888223e-04</span></span>
<span><span class="co">#&gt;               [,6]          [,7]</span></span>
<span><span class="co">#&gt; [1,] -8.064660e-07  6.355805e-06</span></span>
<span><span class="co">#&gt; [2,]  1.930012e-06 -8.340431e-04</span></span>
<span><span class="co">#&gt; [3,] -1.188383e-06  9.558576e-06</span></span>
<span><span class="co">#&gt; [4,]  3.367084e-06 -6.562342e-04</span></span>
<span><span class="co">#&gt; [5,] -4.565237e-07  1.888223e-04</span></span>
<span><span class="co">#&gt; [6,]  4.263256e-08  6.750156e-08</span></span>
<span><span class="co">#&gt; [7,]  6.750156e-08 -2.657963e-05</span></span>
<span></span>
<span><span class="fu"><a href="reference/transition_prob.html">transition_prob</a></span><span class="op">(</span></span>
<span>  <span class="va">amodel</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">.5</span><span class="op">)</span>, </span>
<span>  duplication <span class="op">=</span> <span class="cn">TRUE</span>, state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  array <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">0</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2315802</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-fitting-mcmc">Model fitting MCMC<a class="anchor" aria-label="anchor" href="#model-fitting-mcmc"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">122</span><span class="op">)</span></span>
<span><span class="va">ans_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese_mcmc.html">geese_mcmc</a></span><span class="op">(</span></span>
<span>  <span class="va">amodel</span>,</span>
<span>  nsteps  <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  kernel  <span class="op">=</span> <span class="fu">fmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fmcmc/man/kernel_ram.html" class="external-link">kernel_ram</a></span><span class="op">(</span>warmup <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>, </span>
<span>  prior   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">dlogis</a></span><span class="op">(</span><span class="va">p</span>, scale <span class="op">=</span> <span class="fl">2</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |0%                 |25%                |50%                |75%           100%|</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; ////////////////////////////////////////////////////////////////////////////////</span></span></code></pre></div>
<p>We can take a look at the results like this:</p>
<p><img src="reference/figures/README-mcmc-analysis-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Iterations = 15000:20000</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Thinning interval = 1 </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of chains = 1 </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample size per chain = 5001 </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                          Mean     SD Naive SE Time-series SE</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gains 0 at duplication                 1.2723 0.7586 0.010727        0.05294</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gains 1 at duplication                 1.8373 0.9848 0.013926        0.07326</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loss 0 at duplication                 -1.4241 0.8064 0.011403        0.05438</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loss 1 at duplication                 -0.8163 0.5572 0.007879        0.03446</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Genes with [1, 1] funs at duplication  1.9937 0.2215 0.003132        0.01277</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Root 1                                 0.3445 2.9532 0.041761        0.31086</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Root 2                                -0.3347 3.0158 0.042645        0.33184</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                          2.5%     25%     50%     75%   97.5%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gains 0 at duplication                -0.1466  0.7817  1.2424  1.7714 2.73773</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gains 1 at duplication                 0.2052  1.1583  1.7674  2.4307 3.76635</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loss 0 at duplication                 -3.0947 -1.9784 -1.4155 -0.8769 0.06948</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loss 1 at duplication                 -1.8223 -1.1907 -0.8697 -0.4792 0.39775</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Genes with [1, 1] funs at duplication  1.6037  1.8319  1.9926  2.1413 2.42520</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Root 1                                -4.9226 -1.7294  0.2676  2.0521 6.89956</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Root 2                                -6.3861 -2.1793 -0.2905  1.6815 5.45537</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtaining estimates</span></span>
<span><span class="va">par_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">ans_mcmc</span>, start <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans_pred</span>      <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese-common.html">predict_geese</a></span><span class="op">(</span><span class="va">amodel</span>, <span class="va">par_estimates</span>, leave_one_out <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ans_pred</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">ans_pred</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preparing annotations</span></span>
<span><span class="va">ann_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">fake1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mean Absolute Error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ans_pred</span> <span class="op">-</span> <span class="va">ann_obs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-prediction-1.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># AUC</span></span>
<span><span class="op">(</span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">aphylo</span><span class="fu">::</span><span class="fu">prediction_score</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">ans_pred</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">ann_obs</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Prediction score (H0: Observed = Random)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  N obs.      : 398</span></span>
<span><span class="co">#&gt;  alpha(0, 1) : 0.42, 0.58</span></span>
<span><span class="co">#&gt;  Observed    : 0.81 ***</span></span>
<span><span class="co">#&gt;  Random      : 0.51 </span></span>
<span><span class="co">#&gt;  P(&lt;t)       : 0.0000</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Values scaled to range between 0 and 1, 1 being best.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance levels: *** p &lt; .01, ** p &lt; .05, * p &lt; .10</span></span>
<span><span class="co">#&gt; AUC 0.93.</span></span>
<span><span class="co">#&gt; MAE 0.19.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-prediction-2.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="using-a-flock">Using a flock<a class="anchor" aria-label="anchor" href="#using-a-flock"></a>
</h2>
<p>GEESE models can be grouped (pooled) into a flock.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flock</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flock-class.html">new_flock</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adding first set of annotations</span></span>
<span><span class="fu"><a href="reference/flock-class.html">add_geese</a></span><span class="op">(</span></span>
<span>  <span class="va">flock</span>,</span>
<span>  annotations <span class="op">=</span> <span class="va">fake1</span>,</span>
<span>  geneid      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>  parent      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  duplication <span class="op">=</span> <span class="va">duplication</span>  </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now the second set</span></span>
<span><span class="fu"><a href="reference/flock-class.html">add_geese</a></span><span class="op">(</span></span>
<span>  <span class="va">flock</span>,</span>
<span>  annotations <span class="op">=</span> <span class="va">fake2</span>,</span>
<span>  geneid      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>  parent      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  duplication <span class="op">=</span> <span class="va">duplication</span>  </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adding the model terms</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_gains</a></span><span class="op">(</span><span class="va">flock</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_loss</a></span><span class="op">(</span><span class="va">flock</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_maxfuns</a></span><span class="op">(</span><span class="va">flock</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We need to initialize to do all the accountintg</span></span>
<span><span class="fu"><a href="reference/geese-common.html">init_model</a></span><span class="op">(</span><span class="va">flock</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing nodes in Geese (this could take a while)...</span></span>
<span><span class="co">#&gt; ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</span></span>
<span><span class="co">#&gt; Initializing nodes in Geese (this could take a while)...</span></span>
<span><span class="co">#&gt; ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">flock</span><span class="op">)</span></span>
<span><span class="co">#&gt; FLOCK (GROUP OF GEESE)</span></span>
<span><span class="co">#&gt; INFO ABOUT THE PHYLOGENIES</span></span>
<span><span class="co">#&gt; # of phylogenies         : 2</span></span>
<span><span class="co">#&gt; # of functions           : 2</span></span>
<span><span class="co">#&gt; # of ann. [zeros; ones]  : [166; 234]</span></span>
<span><span class="co">#&gt; # of events [dupl; spec] : [198; 0]</span></span>
<span><span class="co">#&gt; Largest polytomy         : 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; INFO ABOUT THE SUPPORT</span></span>
<span><span class="co">#&gt; Num. of Arrays     : 792</span></span>
<span><span class="co">#&gt; Support size       : 4</span></span>
<span><span class="co">#&gt; Support size range : [0, 14]</span></span>
<span><span class="co">#&gt; Model terms (5)   :</span></span>
<span><span class="co">#&gt;  - Gains 0 at duplication</span></span>
<span><span class="co">#&gt;  - Gains 1 at duplication</span></span>
<span><span class="co">#&gt;  - Loss 0 at duplication</span></span>
<span><span class="co">#&gt;  - Loss 1 at duplication</span></span>
<span><span class="co">#&gt;  - Genes with [1, 1] funs at duplication</span></span></code></pre></div>
<p>We can use the same program to fit the MCMC</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">122</span><span class="op">)</span></span>
<span><span class="va">ans_mcmc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese_mcmc.html">geese_mcmc</a></span><span class="op">(</span></span>
<span>  <span class="va">flock</span>,</span>
<span>  nsteps  <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  kernel  <span class="op">=</span> <span class="fu">fmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fmcmc/man/kernel_ram.html" class="external-link">kernel_ram</a></span><span class="op">(</span>warmup <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>, </span>
<span>  prior   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">dlogis</a></span><span class="op">(</span><span class="va">p</span>, scale <span class="op">=</span> <span class="fl">2</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span></span>
<span>  mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co">#tcl=.5,</span></span>
<span>  las<span class="op">=</span><span class="fl">1</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"n"</span>, oma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ans_mcmc2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmpx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">ans_mcmc2</span>, start <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span><span class="op">[</span>,<span class="va">i</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span></span>
<span>    <span class="va">tmpx</span>, smooth <span class="op">=</span> <span class="cn">FALSE</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">11</span>,<span class="fl">11</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">128</span>, <span class="fl">128</span>, maxColorValue <span class="op">=</span> <span class="fl">255</span><span class="op">)</span>, </span>
<span>    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">params</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lty<span class="op">=</span><span class="fl">3</span>, lwd<span class="op">=</span><span class="fl">4</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-viz-flock-1.png" width="100%"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">ans_mcmc2</span>, start <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations = 10000:20000</span></span>
<span><span class="co">#&gt; Thinning interval = 1 </span></span>
<span><span class="co">#&gt; Number of chains = 1 </span></span>
<span><span class="co">#&gt; Sample size per chain = 10001 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Mean     SD Naive SE Time-series SE</span></span>
<span><span class="co">#&gt; par1  1.75029 0.5658 0.005658       0.031031</span></span>
<span><span class="co">#&gt; par2  1.15245 0.6418 0.006418       0.031898</span></span>
<span><span class="co">#&gt; par3 -1.27191 0.5489 0.005488       0.026757</span></span>
<span><span class="co">#&gt; par4 -1.37351 0.3635 0.003635       0.015714</span></span>
<span><span class="co">#&gt; par5  1.81130 0.1630 0.001630       0.007164</span></span>
<span><span class="co">#&gt; par6  0.20264 2.6196 0.026195       0.304291</span></span>
<span><span class="co">#&gt; par7 -0.09525 1.9988 0.019987       0.192587</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          2.5%     25%     50%     75%   97.5%</span></span>
<span><span class="co">#&gt; par1  0.72459  1.3498  1.7308  2.1272  2.8592</span></span>
<span><span class="co">#&gt; par2  0.03824  0.7103  1.1054  1.5305  2.5470</span></span>
<span><span class="co">#&gt; par3 -2.37365 -1.6300 -1.2692 -0.9166 -0.1438</span></span>
<span><span class="co">#&gt; par4 -2.09160 -1.6242 -1.3736 -1.1207 -0.6764</span></span>
<span><span class="co">#&gt; par5  1.49584  1.6992  1.8025  1.9109  2.1439</span></span>
<span><span class="co">#&gt; par6 -4.78636 -1.4981  0.1150  1.8273  5.1856</span></span>
<span><span class="co">#&gt; par7 -4.12554 -1.3982 -0.1091  1.1896  4.0561</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="limiting-the-support">Limiting the support<a class="anchor" aria-label="anchor" href="#limiting-the-support"></a>
</h2>
<p>In this example, we use the function <code><a href="reference/geese-terms.html">rule_limit_changes()</a></code> to apply a constraint to the support of the model. This takes the 6th term (5th since the index is in C++), and restricts the support to states where there are between ([0, 2]) changes, at most.</p>
<p>This should be useful when dealing with multiple functions or <a href="https://en.wikipedia.org/wiki/Polytomy" class="external-link">pylotomies</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating the object</span></span>
<span><span class="va">amodel_limited</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese-class.html">new_geese</a></span><span class="op">(</span></span>
<span>  annotations <span class="op">=</span> <span class="va">fake1</span>,</span>
<span>  geneid      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>  parent      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tree</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  duplication <span class="op">=</span> <span class="va">duplication</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Adding the model terms</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_gains</a></span><span class="op">(</span><span class="va">amodel_limited</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_loss</a></span><span class="op">(</span><span class="va">amodel_limited</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_maxfuns</a></span><span class="op">(</span><span class="va">amodel_limited</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">term_overall_changes</a></span><span class="op">(</span><span class="va">amodel_limited</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># At most one gain</span></span>
<span><span class="fu"><a href="reference/geese-terms.html">rule_limit_changes</a></span><span class="op">(</span><span class="va">amodel_limited</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># We need to initialize to do all the accounting</span></span>
<span><span class="fu"><a href="reference/geese-common.html">init_model</a></span><span class="op">(</span><span class="va">amodel_limited</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing nodes in Geese (this could take a while)...</span></span>
<span><span class="co">#&gt; ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</span></span>
<span></span>
<span><span class="co"># Is limiting the support any useful?</span></span>
<span><span class="fu"><a href="reference/geese-common.html">support_size</a></span><span class="op">(</span><span class="va">amodel_limited</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 38</span></span></code></pre></div>
<p>Since we added the constraint based on the term <code><a href="reference/geese-terms.html">term_overall_changes()</a></code>, we now need to fix the parameter at 0 (i.e. no effect) during the MCMC model:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">122</span><span class="op">)</span></span>
<span><span class="va">ans_mcmc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geese_mcmc.html">geese_mcmc</a></span><span class="op">(</span></span>
<span>  <span class="va">amodel_limited</span>,</span>
<span>  nsteps  <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  kernel  <span class="op">=</span> <span class="fu">fmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fmcmc/man/kernel_ram.html" class="external-link">kernel_ram</a></span><span class="op">(</span></span>
<span>    warmup <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>    fixed  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, </span>
<span>  prior   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">dlogis</a></span><span class="op">(</span><span class="va">p</span>, scale <span class="op">=</span> <span class="fl">2</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-mcmc-analysis-limited-1.png" width="100%"></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Iterations = 15000:20000</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Thinning interval = 1 </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of chains = 1 </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample size per chain = 5001 </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         Mean     SD Naive SE Time-series SE</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par1  1.5978 0.7201 0.010182        0.04988</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par2  0.2838 0.6662 0.009421        0.04107</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par3 -0.5430 0.7374 0.010428        0.04801</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par4 -1.6198 0.4177 0.005906        0.02535</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par5  1.5778 0.2493 0.003525        0.01590</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par6  0.0000 0.0000 0.000000        0.00000</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par7  0.9949 4.0323 0.057019        0.68642</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par8  0.2408 4.1023 0.058010        0.78150</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         2.5%     25%     50%      75%   97.5%</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par1  0.2735  1.0748  1.6196  2.08840  3.0638</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par2 -1.0489 -0.1436  0.2981  0.70806  1.6241</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par3 -1.9553 -1.0994 -0.5369 -0.03162  0.9411</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par4 -2.4332 -1.9108 -1.6239 -1.35157 -0.7724</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par5  1.1535  1.3999  1.5442  1.72195  2.1680</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par6  0.0000  0.0000  0.0000  0.00000  0.0000</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par7 -5.9244 -1.3063  0.4356  2.95659 11.2694</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; par8 -9.3450 -2.1194  0.1551  2.63111  8.7294</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h1>
<p>Please note that the aphylo2 project is released with a <a href="https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing geese</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>George Vega Yon <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3171-0844" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>National
         Cancer Institute (NCI) <br><small class="roles"> Funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by George Vega Yon, National Cancer Institute (NCI).</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
